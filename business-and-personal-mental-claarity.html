<!DOCTYPE html>
<html>
<head>
    <title>MTOREAI Business and Personal Mental Clarity Chat Widget</title>
    <style>
        .chat-container {
            max-width: 500px;
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
        }
        
        .user-message {
            background: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .assistant-message {
            background: white;
            color: #333;
            border: 1px solid #eee;
        }
        
        .chat-input-container {
            display: flex;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        .send-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-left: 10px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .send-button:hover {
            background: #0056b3;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            MTOREAI Master Qualifier
        </div>
        <div id="chat-messages" class="chat-messages">
            <div class="message assistant-message">
                Hi! I'm your MTOREAI Business and Personal Mental Clarity Specialist. I'll help you cut through mental fog, make clear decisions, overcome limiting beliefs, and find the clarity you need to move your business and life forward with confidence. What decision or challenge is creating confusion for you right now?


           </div>
        </div>
        <div class="chat-input-container">
            <input 
                type="text" 
                id="user-input" 
                class="chat-input" 
                placeholder="Type your message..."
                onkeypress="if(event.key==='Enter') sendMessage()"
            >
            <button onclick="sendMessage()" class="send-button">Send</button>
        </div>
    </div>

    <script>
        // CONFIGURATION - Replace with your actual values
        const OPENAI_API_KEY = 'YOUR_API_KEY';
        const ASSISTANT_ID = 'asst_M3ClDpgUwkiEFgNtQ7WTcetM';
        
        let threadId = null;
        
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const messagesContainer = document.getElementById('chat-messages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show loading state
            const container = document.querySelector('.chat-container');
            container.classList.add('loading');
            
            try {
                // Create thread if first message
                if (!threadId) {
                    const threadResponse = await fetch('https://api.openai.com/v1/threads', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${OPENAI_API_KEY}`,
                            'Content-Type': 'application/json',
                            'OpenAI-Beta': 'assistants=v2'
                        }
                    });
                    const threadData = await threadResponse.json();
                    threadId = threadData.id;
                }
                
                // Add message to thread
                await fetch(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                        'OpenAI-Beta': 'assistants=v2'
                    },
                    body: JSON.stringify({
                        role: 'user',
                        content: message
                    })
                });
                
                // Run assistant
                const runResponse = await fetch(`https://api.openai.com/v1/threads/${threadId}/runs`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                        'OpenAI-Beta': 'assistants=v2'
                    },
                    body: JSON.stringify({
                        assistant_id: ASSISTANT_ID
                    })
                });
                const runData = await runResponse.json();
                
                // Poll for completion
                await pollForCompletion(runData.id);
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, there was an error processing your message. Please try again.', 'assistant');
            } finally {
                container.classList.remove('loading');
            }
        }
        
        async function pollForCompletion(runId) {
            while (true) {
                const response = await fetch(`https://api.openai.com/v1/threads/${threadId}/runs/${runId}`, {
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'OpenAI-Beta': 'assistants=v2'
                    }
                });
                const run = await response.json();
                
                if (run.status === 'completed') {
                    // Get messages
                    const messagesResponse = await fetch(`https://api.openai.com/v1/threads/${threadId}/messages`, {
                        headers: {
                            'Authorization': `Bearer ${OPENAI_API_KEY}`,
                            'OpenAI-Beta': 'assistants=v2'
                        }
                    });
                    const messagesData = await messagesResponse.json();
                    
                    // Get the latest assistant message
                    const latestMessage = messagesData.data[0];
                    if (latestMessage.role === 'assistant') {
                        const content = latestMessage.content[0].text.value;
                        addMessage(content, 'assistant');
                    }
                    break;
                } else if (run.status === 'failed' || run.status === 'cancelled') {
                    addMessage('Sorry, there was an error processing your request.', 'assistant');
                    break;
                }
                
                // Wait 1 second before checking again
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>